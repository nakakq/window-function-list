<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Window Function List</title>
    <style>
        .all {
            color: #222222;
            max-width: 50rem;
            margin: 0 auto;
        }

        .h1 {
            font-size: 1.5rem;
        }

        .parameter {
            margin: 1em;
            padding: 0.5em;
            padding-left: 1em;
            border-left: #AAAAAA solid 2px;
        }

        .parameter .name {
            font-weight: bold;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.3.1.min.js"></script>
    <script src="./bessel/bessel.js"></script>
    <script>
        function clamp01(x) {
            if (x > 1.0) return 1.0;
            if (x < -1.0) return -1.0;
            return x;
        }

        function createAxis(length) {
            // creates [-1, +1] array
            return Array.from({ length: length }, (_, i) => 2 * i / (length - 1) - 1);
        }

        function createWindowArray(f, length) {
            return createAxis(length).map(f);
        }

        const windowList = {
            "": {
                name: "None",
                f: (length, params) => [],
                defaultParams: {},
            },
            "rect": {
                name: "Rectangular (Boxcar)",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        return (xx > -1.0 && xx < 1.0) ? 1.0 : 0.0;
                    }
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "hann": {
                name: "Hann",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return 0.5 + 0.5 * Math.cos(omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "hamming": {
                name: "Hamming",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        if (params.truncate.value > 0.5 && (xx <= -1.0 || xx >= 1.0)) return 0.0;
                        let omega = Math.PI * clamp01(xx);
                        return 0.54 + 0.46 * Math.cos(omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                    truncate: {
                        name: "Truncate?",
                        value: 1,
                        min: 0,
                        max: 1,
                        step: 1,
                    }
                },
            },
            "hamming-exact": {
                name: "Hamming (Exact)",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        if (params.truncate.value > 0.5 && (xx <= -1.0 || xx >= 1.0)) return 0.0;
                        let omega = Math.PI * clamp01(xx);
                        return 0.53836 + 0.46164 * Math.cos(omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                    truncate: {
                        name: "Truncate?",
                        value: 1,
                        min: 0,
                        max: 1,
                        step: 1,
                    }
                },
            },
            "blackman": {
                name: "Blackman",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        let a = params.alpha.value;
                        // 0.42, 0.5, 0.08 when a = 0.16
                        return ((1 - a) + Math.cos(omega) + a * Math.cos(2 * omega)) / 2;
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                    alpha: {
                        name: "Alpha",
                        value: 0.16,
                        min: 0.0,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "blackman-exact": {
                name: "Blackman (Exact)",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return (7938 + 9240 * Math.cos(omega) + 1430 * Math.cos(2 * omega)) / 18608;
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "nuttall": {
                name: "Nuttall",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return 0.355768 + 0.487396 * Math.cos(omega) + 0.144232 * Math.cos(2 * omega) + 0.012604 * Math.cos(3 * omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "blackman-nuttall": {
                name: "Blackman–Nuttall",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return 0.3635819 + 0.4891775 * Math.cos(omega) + 0.1365995 * Math.cos(2 * omega) + 0.0106411 * Math.cos(3 * omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "blackman-harris": {
                name: "Blackman–Harris",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return 0.35875 + 0.48829 * Math.cos(omega) + 0.14128 * Math.cos(2 * omega) + 0.01168 * Math.cos(3 * omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "kawahara-five": {
                name: "Kawahara five-term",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return 0.2940462892 + 0.4539870314 * Math.cos(omega) + 0.2022629686 * Math.cos(2 * omega) + 0.0460129686 * Math.cos(3 * omega) + 0.0036907422 * Math.cos(4 * omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "kawahara-six": {
                name: "Kawahara six-term",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return 0.2624710164 + 0.4265335164 * Math.cos(omega) + 0.2250165621 * Math.cos(2 * omega) + 0.0726831633 * Math.cos(3 * omega) + 0.0125124215 * Math.cos(4 * omega) + 0.0007833203 * Math.cos(5 * omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "flattop": {
                name: "Flat top",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI * clamp01(xx);
                        return 0.215578950 + 0.416631580 * Math.cos(omega) + 0.277263158 * Math.cos(2 * omega) + 0.083578947 * Math.cos(3 * omega) + 0.006947368 * Math.cos(4 * omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
            "cospn": {
                name: "cos^n",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let omega = Math.PI / 2 * clamp01(xx);
                        let truncator = (xx > -1.0 && xx < 1.0) ? 1.0 : 0.0;
                        return Math.pow(Math.cos(omega), params.n.value) * truncator;
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                    n: {
                        name: "n",
                        value: 1.0,
                        min: 1.0,
                        max: 16.0,
                        step: 0.01,
                    },
                },
            },
            "kaiser": {
                name: "Kaiser",
                f: (length, params) => {
                    let alpha = params.alpha.value;
                    let beta = Math.PI * alpha;
                    let denom = BESSEL.besseli(beta, 0);
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        if (xx <= -1.0 || xx >= 1.0) return 0.0;
                        return BESSEL.besseli(beta * Math.sqrt(1 - xx * xx), 0) / denom;
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                    alpha: {
                        name: "α",
                        value: 3.0,
                        min: 2.5,
                        max: 32.0,
                        step: 0.01,
                    },
                },
            },
            "gaussian": {
                name: "Gaussian",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        if (params.truncate.value > 0.5 && (xx <= -1.0 || xx >= 1.0)) return 0.0;
                        return Math.exp(- 0.5 * (xx * xx) / (params.sigma.value * params.sigma.value));
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                    sigma: {
                        name: "σ",
                        value: 0.25,
                        min: 0.01,
                        max: 0.5,
                        step: 0.01,
                    },
                    truncate: {
                        name: "Truncate?",
                        value: 1,
                        min: 0,
                        max: 1,
                        step: 1,
                    }
                },
            },
            "tukey": {
                name: "Tukey",
                f: (length, params) => {
                    let w = (x) => {
                        let xx = x / params.timeScale.value;
                        let width = params.width.value;
                        if (Math.abs(xx) < width)
                            return 1.0;
                        else if (Math.abs(xx) >= 1.0)
                            return 0.0;
                        let omega = Math.PI * clamp01((Math.abs(xx) - width) / (1 - width));
                        return 0.5 + 0.5 * Math.cos(omega);
                    };
                    return createWindowArray(w, length);
                },
                defaultParams: {
                    timeScale: {
                        name: "Time scale",
                        value: 1.0,
                        min: 0.01,
                        max: 1.0,
                        step: 0.01,
                    },
                    width: {
                        name: "Width",
                        value: 0.5,
                        min: 0.0,
                        max: 1.0,
                        step: 0.01,
                    },
                },
            },
        };

        let Plot = {
            numTraces: 0,
            id: "plot",
            init: () => {
                let layout = {
                    margin: { t: 1 },
                    grid: {
                        rows: 1,
                        columns: 2,
                        pattern: "independent",
                    },
                    xaxis: {
                        showgrid: true,
                        zeroline: false,
                        showline: true,
                        mirror: "ticks",
                        linecolor: "#AAAAAA",
                        range: [-1.0, +1.0],
                    },
                    yaxis: {
                        showgrid: true,
                        zeroline: false,
                        showline: true,
                        mirror: "ticks",
                        linecolor: "#AAAAAA",
                        range: [-0.2, 1.2],
                    },
                };
                let config = {
                    responsive: true,
                    staticPlot: true,
                }
                Plotly.newPlot(Plot.id, [], layout, config);
            },
            update: (list) => {
                for (let i = 0; i < Plot.numTraces; i++) {
                    Plotly.deleteTraces(Plot.id, -1);
                }

                let select = document.getElementById("window-type");

                const length = 2048;
                const windowId = select.value;
                const windowType = list[windowId];
                const x = createAxis(length);
                const y = windowType.f(length, windowType.defaultParams);
                let trace1 = {
                    type: "scatter",
                    mode: "lines",
                    name: windowType.name,
                    x: x,
                    y: y,
                    xaxis: "x1",
                    yaxis: "y1",
                };
                Plotly.addTraces(Plot.id, [trace1]);

                Plot.numTraces = 1;
            },
        };

        window.onload = () => {
            new Vue({
                el: "#inspector",
                data: {
                    parameters: windowList,
                    currentWindowId: "",
                },
                created: function () {
                    Plot.init();
                },
                methods: {
                    update: function () {
                        Plot.update(this.parameters);
                    }
                }
            });
        };
    </script>
</head>

<body>
    <div class="all">
        <h1 class="h1">Window Function List</h1>
        <div id="plot" style="width: 100%; height: 300px;"></div>
        <div id="inspector">
            <!-- select box -->
            <select id="window-type" v-model="currentWindowId" v-on:change="update">
                <option v-for="(type, windowId) in parameters" v-bind:value="windowId">{{ type.name }}</option>
            </select>
            <!-- parameter settings -->
            <div v-for="(type, windowId) in parameters" v-if="windowId == currentWindowId">
                <div class="parameter" v-for="(setting, paramId) in type.defaultParams">
                    <label class="name">{{ setting.name }}</label>
                    <div>
                        <input type="number" v-on:change="update" v-model="setting.value" v-bind:min="setting.min"
                            v-bind:max="setting.max" v-bind:step="setting.step">
                        <input type="range" v-on:change="update" v-on:input="update" v-model="setting.value"
                            v-bind:min="setting.min" v-bind:max="setting.max" v-bind:step="setting.step">
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>